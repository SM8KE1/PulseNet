"use strict";const{app:i,BrowserWindow:m,dialog:g,ipcMain:a,shell:h,session:p}=require("electron"),t=require("path"),w=require("is-admin"),s=require("fs"),f=require("ping");function u(){try{let e;if(i.isPackaged){const o=t.dirname(i.getPath("exe"));e=t.join(o,"log.txt")}else e=t.join(i.getAppPath(),"log.txt");const r=t.dirname(e);if(!s.existsSync(r))try{s.mkdirSync(r,{recursive:!0}),console.log("Created directory:",r)}catch(o){throw console.error("Error creating directory:",o),o}if(!s.existsSync(e))try{s.writeFileSync(e,""),console.log("Created log file:",e)}catch(o){throw console.error("Error creating log file:",o),o}return e}catch(e){throw console.error("Error in getLogPath:",e),e}}function l(e){try{const r=u(),c=`[${new Date().toISOString()}] ${e}
`;s.appendFileSync(r,c)}catch(r){console.error("Error writing to log:",r),g.showErrorBox("Log Write Error",`Error writing to log file: ${r.message}`)}}function y(){try{const e=u();s.writeFileSync(e,""),console.log("Log file reset successfully")}catch(e){console.error("Error resetting log file:",e),g.showErrorBox("Log Reset Error",`Error resetting log file: ${e.message}`)}}a.on("log-ping",(e,r)=>{l(r)});a.handle("ping-host",async(e,r)=>{try{const o=await f.promise.probe(r,{timeout:10,extra:["-c","1"]}),c=o.alive?`Success (${o.time} ms)`:"No Response";return l(`Ping to ${r}: ${c}`),{alive:o.alive,time:o.time,error:null}}catch(o){return l(`Ping to ${r}: Error: ${o.message}`),{alive:!1,time:null,error:o.message}}});a.on("open-github-link",()=>{h.openExternal("https://github.com/SM8KE1/PulseNet")});let n;function d(){n=new m({width:800,height:600,webPreferences:{preload:t.join(__dirname,"preload.js"),nodeIntegration:!1,contextIsolation:!0,webSecurity:!1},frame:!1,titleBarStyle:"hidden",backgroundColor:"#1a1a1a",icon:t.join(__dirname,"../assets/icon.ico"),title:"PulseNet"}),n.setMenu(null);const e=process.env.VITE_DEV_SERVER_URL;e?n.loadURL(e):n.loadFile(t.join(__dirname,"../dist/index.html")),a.on("minimize-window",()=>{n.minimize()}),a.on("close-window",()=>{n.close()})}async function E(){try{await w()||g.showMessageBox({type:"warning",title:"Admin Access Required",message:"This application requires administrator access to run ping commands. Please run the application as administrator.",buttons:["OK"]})}catch(e){console.error("Error checking admin rights:",e)}}i.whenReady().then(async()=>{process.env.VITE_DEV_SERVER_URL||p.defaultSession.webRequest.onHeadersReceived((e,r)=>{r({responseHeaders:{...e.responseHeaders,"Content-Security-Policy":["script-src 'self'"]}})}),y(),await E(),d(),i.on("activate",()=>{m.getAllWindows().length===0&&d()})});i.on("window-all-closed",()=>{process.platform!=="darwin"&&i.quit()});
